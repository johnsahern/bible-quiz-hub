
import { BiblicalContext } from './biblical-contexts.ts';
import { DifficultyInstruction } from './difficulty-instructions.ts';

export function buildRigorousPrompt(
  selectedContext: BiblicalContext,
  selectedDifficulty: DifficultyInstruction,
  questionCount: number,
  ultraUniqueSeed: number
): string {
  // Ajouter des instructions sp√©cifiques pour forcer la variabilit√© ET la pr√©cision th√©matique
  const uniquenessInstructions = `
üé≤ IMP√âRATIF D'UNICIT√â ABSOLUE (SEED: ${ultraUniqueSeed}):
- Utilisez ce seed ${ultraUniqueSeed} comme base pour cr√©er des questions TOTALEMENT DIFF√âRENTES
- INTERDICTION de r√©p√©ter des questions d√©j√† pos√©es sur ce th√®me
- Explorez des angles IN√âDITS et des versets DIFF√âRENTS √† chaque g√©n√©ration
- Variez les types de questions : factuelle, g√©ographique, chronologique, th√©ologique
- Changez les personnages, √©v√©nements et r√©f√©rences bibliques abord√©s
- CR√âATIVIT√â MAXIMALE requise - pensez √† des aspects peu explor√©s du th√®me
- Si c'est la m√™me th√©matique, abordez des sous-aspects COMPL√àTEMENT DIFF√âRENTS
`;

  // Instructions renforc√©es pour la pr√©cision th√©matique
  const thematicPrecisionInstructions = `
üéØ PR√âCISION TH√âMATIQUE ABSOLUE REQUISE :
- TOUTES les questions DOIVENT √™tre directement li√©es au th√®me "${selectedContext.title}"
- INTERDICTION de poser des questions g√©n√©rales sur d'autres sujets bibliques
- Chaque question doit explorer un aspect SP√âCIFIQUE du th√®me choisi
- Les personnages, √©v√©nements et r√©f√©rences mentionn√©s doivent √™tre PERTINENTS au th√®me
- √âvitez les questions trop g√©n√©rales qui pourraient s'appliquer √† d'autres th√®mes
- Concentrez-vous sur les d√©tails, enseignements et aspects uniques du th√®me "${selectedContext.title}"
- Si le th√®me concerne un personnage : questions sur sa vie, ses actions, ses paroles, son contexte
- Si le th√®me concerne un livre biblique : questions sur son contenu, ses personnages, ses enseignements
- Si le th√®me concerne un concept : questions sur ses applications, ses exemples bibliques, ses implications
`;

  return `En tant qu'expert th√©ologien √©vang√©lique reconnu et docteur en √©tudes bibliques, je vous demande de cr√©er un quiz biblique d'excellence acad√©mique sur "${selectedContext.title}".

üîç CONTEXTE BIBLIQUE D√âTAILL√â :
${selectedContext.context}

üìö VERSETS CL√âS DE R√âF√âRENCE :
${selectedContext.keyVerses?.join(', ') || 'R√©f√©rences contextuelles pr√©cises requises'}

üéØ NIVEAU EXIG√â : ${selectedDifficulty.instructions}

${uniquenessInstructions}

${thematicPrecisionInstructions}

‚ö†Ô∏è EXIGENCES DOCTRINALES ABSOLUES :
1. EXACTITUDE BIBLIQUE PARFAITE - Aucune erreur factuelle tol√©r√©e
2. CONFORMIT√â ORTHODOXE - Respecter la doctrine √©vang√©lique historique
3. R√âF√âRENCES PR√âCISES - Chaque question doit citer des versets authentiques
4. V√âRIT√â TH√âOLOGIQUE - √âviter toute ambigu√Øt√© doctrinale
5. ORIGINALIT√â TOTALE - Questions jamais formul√©es (seed: ${ultraUniqueSeed})
6. PERTINENCE TH√âMATIQUE - Toutes les questions doivent √™tre directement li√©es au th√®me "${selectedContext.title}"

üìã FORMAT JSON REQUIS (AUCUN AUTRE TEXTE) :
[
  {
    "id": "q1",
    "question": "Question biblique pr√©cise et th√©ologiquement exacte sur ${selectedContext.title}",
    "options": ["Option A", "Option B", "Option C", "Option D"],
    "correctAnswer": 0,
    "verse": "R√©f√©rence biblique exacte avec citation courte"
  }
]

üé™ CR√âATIVIT√â BIBLIQUE MAXIMALE AVEC SEED ${ultraUniqueSeed} :
- Explorez diff√©rents aspects du th√®me "${selectedContext.title}" (historique, proph√©tique, typologique, symbolique)
- Variez les types de questions (qui, quoi, o√π, quand, pourquoi, comment) TOUJOURS en lien avec le th√®me
- Utilisez des angles d'approche originaux et enrichissants SP√âCIFIQUES au th√®me
- √âvitez les formulations banales ou r√©p√©titives
- Questions stimulantes testant la vraie connaissance du th√®me "${selectedContext.title}"
- Puisez dans TOUTE la richesse SP√âCIFIQUE du th√®me "${selectedContext.title}"
- Abordez des d√©tails moins connus mais bibliquement solides RELATIFS au th√®me
- Variez les livres bibliques r√©f√©renc√©s MAIS TOUJOURS en rapport avec le th√®me "${selectedContext.title}"

‚ö° G√âN√âREZ MAINTENANT ${questionCount} QUESTIONS BIBLIQUES PARFAITES ET UNIQUES :
Th√®me EXCLUSIF : "${selectedContext.title}"
Niveau : ${selectedDifficulty.level}
Seed d'unicit√© : ${ultraUniqueSeed}
IMP√âRATIF : Questions DIFF√âRENTES √† chaque g√©n√©ration ET TOUJOURS sur le th√®me "${selectedContext.title}" !

‚ö†Ô∏è RAPPEL CRITIQUE : Chaque question doit √™tre directement et sp√©cifiquement li√©e au th√®me "${selectedContext.title}". Aucune question g√©n√©rale sur d'autres sujets bibliques n'est accept√©e !

R√âPONDEZ UNIQUEMENT AVEC LE TABLEAU JSON - RIEN D'AUTRE !`;
}
